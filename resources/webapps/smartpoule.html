<!-- vim: set filetype=javascript: -->
<!DOCTYPE html>
<html>
  <title>SmartPoule</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no">

  <!--***********************************-->
  <head>
    <icon
        id="close.svg"
        data-url="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCA0OCA0OCI+PHRpdGxlPkdub21lIHdpbmRvdyBjbG9zZTwvdGl0bGU+PGRlc2M+aHR0cDovL3N2bi5nbm9tZS5vcmcvdmlld3ZjL2dub21lLWljb24tdGhlbWUvPC9kZXNjPjxyYWRpYWxHcmFkaWVudCBpZD0iU1ZHSURfMV8iIGN4PSItNjYuMTAwNiIgY3k9Ii0xMDQ3LjQ4MDUiIHI9IjEuNjA1NSIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgxMy43ODE5IDAgMCAtMi40NTg3IDkzNC45OTE4IC0yNTQxLjQzNzcpIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHN0b3Agb2Zmc2V0PSIwIiBzdHlsZT0ic3RvcC1jb2xvcjojMDAwIi8+PHN0b3Agb2Zmc2V0PSIxIiBzdHlsZT0ic3RvcC1jb2xvcjojMDAwO3N0b3Atb3BhY2l0eTowIi8+PC9yYWRpYWxHcmFkaWVudD48cGF0aCBzdHlsZT0ib3BhY2l0eTouMDkyO2ZpbGw6dXJsKCNTVkdJRF8xXykiIGQ9Ik00Ni4xMjcsMzMuOTc5YzAsMi4xODItOS45MDYsMy45NDctMjIuMTI3LDMuOTQ3Yy0xMi4yMiwwLTIyLjEyNi0xLjc2OC0yMi4xMjYtMy45NDdjMC0yLjE3OSw5LjkwNi0zLjk0NiwyMi4xMjYtMy45NDZDMzYuMjIyLDMwLjAzMiw0Ni4xMjcsMzEuOCw0Ni4xMjcsMzMuOTc5eiIvPjxyYWRpYWxHcmFkaWVudCBpZD0iU1ZHSURfMl8iIGN4PSIxNDguMjAxMiIgY3k9Ii0xMDI5LjU5OTYiIHI9IjEuNjAzNiIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCg1LjMzODEgMCAwIC0yLjQ5NDQgLTc3OC4xMDM4IC0yNTMyLjgzMjUpIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHN0b3Agb2Zmc2V0PSIwIiBzdHlsZT0ic3RvcC1jb2xvcjojMDAwIi8+PHN0b3Agb2Zmc2V0PSIxIiBzdHlsZT0ic3RvcC1jb2xvcjojMDAwO3N0b3Atb3BhY2l0eTowIi8+PC9yYWRpYWxHcmFkaWVudD48cGF0aCBzdHlsZT0ib3BhY2l0eTouMjAzMTtmaWxsOnVybCgjU1ZHSURfMl8pIiBkPSJNMjIsMzUuMzkyYzAsMi4zMjItNC4wMjksNC4yMDUtOSw0LjIwNXMtOS0xLjg4My05LTQuMjA1czQuMDI5LTQuMjA1LDktNC4yMDVTMjIsMzMuMDY5LDIyLDM1LjM5MnoiLz48cmFkaWFsR3JhZGllbnQgaWQ9IlNWR0lEXzNfIiBjeD0iMTI3LjA1OTYiIGN5PSItMTAxNi4zOTA2IiByPSIxLjYwNjYiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoNS40MDU5IDAgMCAtMi41MjU5IC02NTIuODcwNCAtMjUzMS44NTc3KSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPjxzdG9wIG9mZnNldD0iMCIgc3R5bGU9InN0b3AtY29sb3I6IzAwMCIvPjxzdG9wIG9mZnNldD0iMSIgc3R5bGU9InN0b3AtY29sb3I6IzAwMDtzdG9wLW9wYWNpdHk6MCIvPjwvcmFkaWFsR3JhZGllbnQ+PHBhdGggc3R5bGU9Im9wYWNpdHk6LjIwMzE7ZmlsbDp1cmwoI1NWR0lEXzNfKSIgZD0iTTQzLDM1LjM5MmMwLDIuMzIyLTQuMDI4LDQuMjA1LTksNC4yMDVjLTQuOTcxLDAtOS0xLjg4My05LTQuMjA1czQuMDI5LTQuMjA1LDktNC4yMDVDMzguOTcyLDMxLjE4Nyw0MywzMy4wNjksNDMsMzUuMzkyeiIvPjxyYWRpYWxHcmFkaWVudCBpZD0iU1ZHSURfNF8iIGN4PSItMTguMzk2NSIgY3k9Ii0yMjkuNDgyOSIgcj0iMS40OTMxIiBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDEwLjExMjUgMCAwIC0xMC4xMDQgMjA5LjY4OTEgLTIyOTkuMzUwMykiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj48c3RvcCBvZmZzZXQ9IjAiIHN0eWxlPSJzdG9wLWNvbG9yOiM5QzlFOTkiLz48c3RvcCBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiM4Njg4ODMiLz48L3JhZGlhbEdyYWRpZW50PjxwYXRoIHN0eWxlPSJmaWxsOnVybCgjU1ZHSURfNF8pO3N0cm9rZTojNTU1NzUzO3N0cm9rZS13aWR0aDouODEyNTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQiIGQ9Ik0xMy4xMDIsOC40MDVjLTEuNDU2LTAuMDEtMi43ODgsMC44NzktMy4zMzksMi4yMjdjLTAuNTUxLDEuMzQ4LTAuMjEyLDIuODgzLDAuODM0LDMuODk2bDguMDEzLDguMDEzbC04LjAxMyw4LjAxM2MtMS4zOTgsMS4zOTgtMS4zOTgsMy42NjYsMCw1LjA2NGMxLjM5OCwxLjM5OCwzLjY2NiwxLjM5OCw1LjA2NCwwbDguMDE0LTguMDE0bDguMDEzLDguMDE0YzAuODk4LDAuOTI0LDIuMjA0LDEuMjc3LDMuNDUsMC45NDVjMS4yNDUtMC4zMzIsMi4yNDEtMS4zMTMsMi41NjEtMi41NjFjMC4zMTgtMS4yNDktMC4wNjctMi41NjMtMS4wMDItMy40NWwtOC4wMTQtOC4wMTRsOC4wMTQtOC4wMTNjMS4wNTYtMS4wMjEsMS40LTIuNiwwLjgzNC0zLjk1MWMtMC41NjMtMS4zNTQtMS45MjgtMi4yMDUtMy4zOTYtMi4xN2MtMC45MywwLjAzNy0xLjgwOSwwLjQzNy0yLjQ0NywxLjExMWwtOC4wMTMsOC4wMTRsLTguMDE0LTguMDE0QzE0Ljk5NSw4LjgxNSwxNC4wNjksOC40MTMsMTMuMTAyLDguNDA1eiIvPjxwYXRoIHhsaW5rOmhyZWY9IiNwYXRoNDI2MiIgc3R5bGU9Im9wYWNpdHk6LjM2MjE7ZmlsbDpub25lO3N0cm9rZTojRkZGRkZGO3N0cm9rZS13aWR0aDouODEyNTtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQiIGQ9Ik0xMy4xMjYsOS40MDVjLTEuMDM3LTAuMDA4LTIuMDMsMC42NTQtMi40MjMsMS42MTVzLTAuMTQ3LDIuMDMsMC42MTUsMi43NzFjMC4wMTMsMCwwLjAyNSwwLDAuMDM5LDBsOCw4LjAzOGMwLjE5OSwwLjE5MSwwLjMxMSwwLjQ1NSwwLjMxMSwwLjczcy0wLjExMiwwLjU0MS0wLjMxMSwwLjczMWwtOCw4Yy0xLjAwOSwxLjAwOS0xLjAwOSwyLjYwNSwwLDMuNjE1YzEuMDA4LDEuMDA5LDIuNjA2LDEuMDA5LDMuNjE1LDBsOC04LjAzOWMwLjE5MS0wLjE5OCwwLjQ1NS0wLjMxMywwLjczMS0wLjMxM2MwLjI3NSwwLDAuNTM5LDAuMTEyLDAuNzMsMC4zMTNsOCw4LjAzOWMwLDAuMDEzLDAsMC4wMjMsMCwwLjAzN2MwLjYzNywwLjY1NiwxLjU1LDAuODk2LDIuNDYxLDAuNjU0YzAuOTA0LTAuMjQyLDEuNTgxLTAuOTU3LDEuODA5LTEuODQ3YzAuMjI4LTAuODk2LTAuMDIxLTEuODIzLTAuNjkzLTIuNDYyYy0wLjAxMiwwLTAuMDI0LDAtMC4wMzcsMGwtOC04Yy0wLjE5OC0wLjE5MS0wLjMxMy0wLjQ1NS0wLjMxMy0wLjczczAuMTEzLTAuNTQxLDAuMzEzLTAuNzNsOC04LjAzOGMwLjAxMywwLDAuMDI1LDAsMC4wMzcsMGMwLjc2LTAuNzMzLDEuMDE1LTEuODk2LDAuNjE1LTIuODQ3Yy0wLjM5OS0wLjk1OS0xLjM1NC0xLjU2My0yLjQyMi0xLjUzOWMtMC42NjQsMC4wMjUtMS4zMTUsMC4zMjgtMS43NywwLjgwOWMwLDAuMDE0LDAsMC4wMjUsMCwwLjAzOWwtOCw4LjAwMWMtMC4xOTEsMC4xOTgtMC40NTUsMC4zMTItMC43MywwLjMxMmMtMC4yNzYsMC0wLjU0LTAuMTEyLTAuNzMxLTAuMzEybC04LTguMDAxYzAtMC4wMTQsMC0wLjAyNSwwLTAuMDM5QzE0LjUwMSw5LjcxNSwxMy44MTksOS40MTEsMTMuMTI2LDkuNDA1eiIvPjxyYWRpYWxHcmFkaWVudCBpZD0iU1ZHSURfNV8iIGN4PSI0Ni4zNjcyIiBjeT0iLTY2NiIgcj0iMS44OTU4IiBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDcuNTk3MyAwIDAgLTMuODI0NSAtMzI5LjczOTMgLTI1MjQuODA3NikiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj48c3RvcCBvZmZzZXQ9IjAiIHN0eWxlPSJzdG9wLWNvbG9yOiM1NTU3NTMiLz48c3RvcCBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiM1NTU3NTM7c3RvcC1vcGFjaXR5OjAiLz48L3JhZGlhbEdyYWRpZW50PjxwYXRoIHN0eWxlPSJvcGFjaXR5Oi4zO2ZpbGw6dXJsKCNTVkdJRF81XykiIGQ9Ik0xOS40NTQsMjIuNTU5YzUuMjIyLTEuNTIyLDMuODgyLDAuMTY0LDguNTA3LDAuMTY0bDguNTA2LDguNTA2bC00LjcwNCwzLjY0bC04LTguMDY4bC04LDcuNzk4TDExLjU4LDMwLjVMMTkuNDU0LDIyLjU1OXoiLz48L3N2Zz4=">
    </icon>

    <icon
        id="ok.svg"
        data-url="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnIGlkPSJzdmcxMTMwMCIgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iNDhweCIgd2lkdGg9IjQ4cHgiIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPgogPGRlZnMgaWQ9ImRlZnMzIj4KICA8cmFkaWFsR3JhZGllbnQgaWQ9InJhZGlhbEdyYWRpZW50MTQ0NCIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGN5PSIzNi40MjEiIGN4PSIyNC44MzciIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLjUzNjcyIC0xLjcxOTllLTE1IDE2Ljg3MykiIHI9IjE1LjY0NSI+CiAgIDxzdG9wIGlkPSJzdG9wODY2NCIgb2Zmc2V0PSIwIi8+CiAgIDxzdG9wIGlkPSJzdG9wODY2NiIgc3RvcC1vcGFjaXR5PSIwIiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogIDxsaW5lYXJHcmFkaWVudCBpZD0ibGluZWFyR3JhZGllbnQxNDU1IiB5Mj0iMjQuNTU4IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDI9Ii05MS41MTMiIGdyYWRpZW50VHJhbnNmb3JtPSJ0cmFuc2xhdGUoLjUyNzE0IC0uMDIzMTk5KSIgeTE9Ii01LjM4NzkiIHgxPSItODQuMzQ0Ij4KICAgPHN0b3AgaWQ9InN0b3AxNzMzIiBzdG9wLWNvbG9yPSIjYTdjYzVjIiBvZmZzZXQ9IjAiLz4KICAgPHN0b3AgaWQ9InN0b3AxNzM1IiBzdG9wLWNvbG9yPSIjNzg5ZTJkIiBvZmZzZXQ9IjEiLz4KICA8L2xpbmVhckdyYWRpZW50PgogPC9kZWZzPgogPG1ldGFkYXRhIGlkPSJtZXRhZGF0YTQiPgogIDxyZGY6UkRGPgogICA8Y2M6V29yayByZGY6YWJvdXQ9IiI+CiAgICA8ZGM6Zm9ybWF0PmltYWdlL3N2Zyt4bWw8L2RjOmZvcm1hdD4KICAgIDxkYzp0eXBlIHJkZjpyZXNvdXJjZT0iaHR0cDovL3B1cmwub3JnL2RjL2RjbWl0eXBlL1N0aWxsSW1hZ2UiLz4KICAgIDxkYzpjcmVhdG9yPgogICAgIDxjYzpBZ2VudD4KICAgICAgPGRjOnRpdGxlPkpha3ViIFN0ZWluZXI8L2RjOnRpdGxlPgogICAgIDwvY2M6QWdlbnQ+CiAgICA8L2RjOmNyZWF0b3I+CiAgICA8ZGM6c291cmNlPmh0dHA6Ly9qaW1tYWMubXVzaWNoYWxsLmN6PC9kYzpzb3VyY2U+CiAgICA8Y2M6bGljZW5zZSByZGY6cmVzb3VyY2U9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzIuMC8iLz4KICAgIDxkYzp0aXRsZT5EaWFsb2cgb2s8L2RjOnRpdGxlPgogICAgPGRjOnN1YmplY3Q+CiAgICAgPHJkZjpCYWc+CiAgICAgIDxyZGY6bGk+b2s8L3JkZjpsaT4KICAgICAgPHJkZjpsaT5zdXJlPC9yZGY6bGk+CiAgICAgIDxyZGY6bGk+c2V0PC9yZGY6bGk+CiAgICAgIDxyZGY6bGk+YXBwbHk8L3JkZjpsaT4KICAgICA8L3JkZjpCYWc+CiAgICA8L2RjOnN1YmplY3Q+CiAgICA8ZGM6Y29udHJpYnV0b3I+CiAgICAgPGNjOkFnZW50PgogICAgICA8ZGM6dGl0bGU+QW5kcmVhcyBOaWxzc29uPC9kYzp0aXRsZT4KICAgICA8L2NjOkFnZW50PgogICAgPC9kYzpjb250cmlidXRvcj4KICAgPC9jYzpXb3JrPgogICA8Y2M6TGljZW5zZSByZGY6YWJvdXQ9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LXNhLzIuMC8iPgogICAgPGNjOnBlcm1pdHMgcmRmOnJlc291cmNlPSJodHRwOi8vd2ViLnJlc291cmNlLm9yZy9jYy9SZXByb2R1Y3Rpb24iLz4KICAgIDxjYzpwZXJtaXRzIHJkZjpyZXNvdXJjZT0iaHR0cDovL3dlYi5yZXNvdXJjZS5vcmcvY2MvRGlzdHJpYnV0aW9uIi8+CiAgICA8Y2M6cmVxdWlyZXMgcmRmOnJlc291cmNlPSJodHRwOi8vd2ViLnJlc291cmNlLm9yZy9jYy9Ob3RpY2UiLz4KICAgIDxjYzpyZXF1aXJlcyByZGY6cmVzb3VyY2U9Imh0dHA6Ly93ZWIucmVzb3VyY2Uub3JnL2NjL0F0dHJpYnV0aW9uIi8+CiAgICA8Y2M6cGVybWl0cyByZGY6cmVzb3VyY2U9Imh0dHA6Ly93ZWIucmVzb3VyY2Uub3JnL2NjL0Rlcml2YXRpdmVXb3JrcyIvPgogICAgPGNjOnJlcXVpcmVzIHJkZjpyZXNvdXJjZT0iaHR0cDovL3dlYi5yZXNvdXJjZS5vcmcvY2MvU2hhcmVBbGlrZSIvPgogICA8L2NjOkxpY2Vuc2U+CiAgPC9yZGY6UkRGPgogPC9tZXRhZGF0YT4KIDxnIGlkPSJsYXllcjEiPgogIDxwYXRoIGlkPSJwYXRoODY2MCIgb3BhY2l0eT0iLjIwNDU1IiBzdHlsZT0iY29sb3I6IzAwMDAwMCIgZD0ibTQwLjQ4MiAzNi40MjFhMTUuNjQ1IDguMzk2OSAwIDEgMSAtMzEuMjkgMCAxNS42NDUgOC4zOTY5IDAgMSAxIDMxLjI5IDB6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHRyYW5zZm9ybT0ibWF0cml4KDEuMjE0NSAwIDAgLjU5NTQ2IC02LjE2MzggMjAuMzEzKSIgZmlsbD0idXJsKCNyYWRpYWxHcmFkaWVudDE0NDQpIi8+CiAgPGcgaWQ9ImcxNTI5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMTEuNzQgMTUuNTc5KSI+CiAgIDxnIGlkPSJnMTQ1MCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgdHJhbnNmb3JtPSJtYXRyaXgoMS4wMTczIC0uMjQzNTYgLjI0MzU2IDEuMDE3MyAtMS43NDU3IC0yMy4zODMpIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS13aWR0aD0iLjk1NTk4Ij4KICAgIDxwYXRoIGlkPSJwYXRoMTU0MiIgZD0ibS03My44ODItNC42MjkzYy0wLjUwOC0wLjE3NzQtMS4wODYtMC4wNDY0LTEuNDcxIDAuMzc4OWwtMTYuMzgyIDE4LjExNi01LjkzLTcuNTc3NmMtMC41NjctMC41MTI3LTEuNDM2LTAuNDc4Mi0xLjk0OCAwLjA4ODhsLTQuMjk3IDMuNDMwNmMtMC41MSAwLjU2NzItMC40NyAxLjQzODIgMC4xIDEuOTUxMiAwIDAgMTAuNzMxIDE0LjI0NyAxMC43NDUgMTQuMjU5IDAuMTMzIDAuMTIgMC4yODMgMC4yIDAuNDQxIDAuMjYgMC41MTQgMC4xOTQgMS4xMTggMC4wNzUgMS41MS0wLjM2bDIyLjA5NC0yNC40MzJjMC41MTItMC41NjY1MyAwLjQ2Ny0xLjQzNzctMC4xLTEuOTUwNGwtNC4yODItMy44ODU0Yy0wLjE0MS0wLjEyODItMC4zMTEtMC4yMjA0LTAuNDgtMC4yNzk1eiIgc3Ryb2tlPSIjNDI3NzBjIiBmaWxsPSJ1cmwoI2xpbmVhckdyYWRpZW50MTQ1NSkiLz4KICAgIDxwYXRoIGlkPSJwYXRoMTU0NCIgb3BhY2l0eT0iLjQ4MSIgZD0ibS03NC45NzktMy4yMDE3bC04LjMxIDkuMjIyOS03LjM4NCA4LjEyMThjLTAuMjA2IDAuMTI5LTAuMjgzIDAuNjc0LTEuMDUxIDAuNjg1LTAuNTMyIDAuMDA4LTAuNTc4LTAuMi0xLjAyNC0wLjY2NmwtNS4yNC02LjY1MjdjLTAuNTgxLTAuNzUwMS0wLjU2Ni0wLjcxNDgtMS4xOTgtMC4zMjM1bC0zLjM3NCAyLjY1MjdjLTAuODggMC41ODA1LTAuODggMS4wNTg1LTAuMTQgMS44MjU1IDAgMCA5Ljc1NSAxMi45MzMgOS43NjggMTIuOTQ1IDAuMTI2IDAuMTEzIDAuMDU4IDAuMTI1IDAuNTc2IDAuNzA2IDAuMzMzIDAuMzcyIDAuODk1LTAuNDIzIDEuMjY0LTAuODMxbDIxLjI0Mi0yMy40MzZjMC40ODItMC41MzMyNiAwLjQ1NC0wLjUzMTA4LTAuMDgyLTEuMDE2bC0zLjg0OS0zLjM5MzJjLTAuNTUzLTAuNDk3Ni0wLjU1Ny0wLjQ5NDQtMS4xOTggMC4xNTk1eiIgc3Ryb2tlPSIjZmZmIiBmaWxsPSJub25lIi8+CiAgIDwvZz4KICA8L2c+CiA8L2c+Cjwvc3ZnPgo=">
    </icon>

    <icon
        id="ko.svg"
        data-url="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcKICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIgogICB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgd2lkdGg9IjEwMCUiCiAgIGhlaWdodD0iMTAwJSIKICAgdmlld0JveD0iMCAwIDQ4IDQ4IgogICBpZD0ic3ZnMiIKICAgdmVyc2lvbj0iMS4xIgogICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjkxIHIxMzcyNSIKICAgc29kaXBvZGk6ZG9jbmFtZT0iQmxhY2tfY2FyZC5zdmciPgogIDxtZXRhZGF0YQogICAgIGlkPSJtZXRhZGF0YTQ5Ij4KICAgIDxyZGY6UkRGPgogICAgICA8Y2M6V29yawogICAgICAgICByZGY6YWJvdXQ9IiI+CiAgICAgICAgPGRjOmZvcm1hdD5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQ+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9wdXJsLm9yZy9kYy9kY21pdHlwZS9TdGlsbEltYWdlIiAvPgogICAgICA8L2NjOldvcms+CiAgICA8L3JkZjpSREY+CiAgPC9tZXRhZGF0YT4KICA8ZGVmcwogICAgIGlkPSJkZWZzNDciIC8+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICBib3JkZXJvcGFjaXR5PSIxIgogICAgIG9iamVjdHRvbGVyYW5jZT0iMTAiCiAgICAgZ3JpZHRvbGVyYW5jZT0iMTAiCiAgICAgZ3VpZGV0b2xlcmFuY2U9IjEwIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwIgogICAgIGlua3NjYXBlOnBhZ2VzaGFkb3c9IjIiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIxMjM4IgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjkzOCIKICAgICBpZD0ibmFtZWR2aWV3NDUiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjQuOTE2NjY2NyIKICAgICBpbmtzY2FwZTpjeD0iMjQiCiAgICAgaW5rc2NhcGU6Y3k9IjI0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIyNCIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIwIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9InN2ZzIiIC8+CiAgPHRpdGxlCiAgICAgaWQ9InRpdGxlNCI+R25vbWUgd2luZG93IGNsb3NlPC90aXRsZT4KICA8ZGVzYwogICAgIGlkPSJkZXNjNiI+aHR0cDovL3N2bi5nbm9tZS5vcmcvdmlld3ZjL2dub21lLWljb24tdGhlbWUvPC9kZXNjPgogIDxyYWRpYWxHcmFkaWVudAogICAgIGlkPSJTVkdJRF8xXyIKICAgICBjeD0iLTY2LjEwMDYiCiAgICAgY3k9Ii0xMDQ3LjQ4MDUiCiAgICAgcj0iMS42MDU1IgogICAgIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMTMuNzgxOSAwIDAgLTIuNDU4NyA5MzQuOTkxOCAtMjU0MS40Mzc3KSIKICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CiAgICA8c3RvcAogICAgICAgb2Zmc2V0PSIwIgogICAgICAgc3R5bGU9InN0b3AtY29sb3I6IzAwMCIKICAgICAgIGlkPSJzdG9wOSIgLz4KICAgIDxzdG9wCiAgICAgICBvZmZzZXQ9IjEiCiAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojMDAwO3N0b3Atb3BhY2l0eTowIgogICAgICAgaWQ9InN0b3AxMSIgLz4KICA8L3JhZGlhbEdyYWRpZW50PgogIDxwYXRoCiAgICAgc3R5bGU9Im9wYWNpdHk6LjA5MjtmaWxsOnVybCgjU1ZHSURfMV8pIgogICAgIGQ9Ik00Ni4xMjcsMzMuOTc5YzAsMi4xODItOS45MDYsMy45NDctMjIuMTI3LDMuOTQ3Yy0xMi4yMiwwLTIyLjEyNi0xLjc2OC0yMi4xMjYtMy45NDdjMC0yLjE3OSw5LjkwNi0zLjk0NiwyMi4xMjYtMy45NDZDMzYuMjIyLDMwLjAzMiw0Ni4xMjcsMzEuOCw0Ni4xMjcsMzMuOTc5eiIKICAgICBpZD0icGF0aDEzIiAvPgogIDxyYWRpYWxHcmFkaWVudAogICAgIGlkPSJTVkdJRF8yXyIKICAgICBjeD0iMTQ4LjIwMTIiCiAgICAgY3k9Ii0xMDI5LjU5OTYiCiAgICAgcj0iMS42MDM2IgogICAgIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoNS4zMzgxIDAgMCAtMi40OTQ0IC03NzguMTAzOCAtMjUzMi44MzI1KSIKICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CiAgICA8c3RvcAogICAgICAgb2Zmc2V0PSIwIgogICAgICAgc3R5bGU9InN0b3AtY29sb3I6IzAwMCIKICAgICAgIGlkPSJzdG9wMTYiIC8+CiAgICA8c3RvcAogICAgICAgb2Zmc2V0PSIxIgogICAgICAgc3R5bGU9InN0b3AtY29sb3I6IzAwMDtzdG9wLW9wYWNpdHk6MCIKICAgICAgIGlkPSJzdG9wMTgiIC8+CiAgPC9yYWRpYWxHcmFkaWVudD4KICA8cmFkaWFsR3JhZGllbnQKICAgICBpZD0iU1ZHSURfM18iCiAgICAgY3g9IjEyNy4wNTk2IgogICAgIGN5PSItMTAxNi4zOTA2IgogICAgIHI9IjEuNjA2NiIKICAgICBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDUuNDA1OSAwIDAgLTIuNTI1OSAtNjUyLjg3MDQgLTI1MzEuODU3NykiCiAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgogICAgPHN0b3AKICAgICAgIG9mZnNldD0iMCIKICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiMwMDAiCiAgICAgICBpZD0ic3RvcDIzIiAvPgogICAgPHN0b3AKICAgICAgIG9mZnNldD0iMSIKICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiMwMDA7c3RvcC1vcGFjaXR5OjAiCiAgICAgICBpZD0ic3RvcDI1IiAvPgogIDwvcmFkaWFsR3JhZGllbnQ+CiAgPHJhZGlhbEdyYWRpZW50CiAgICAgaWQ9IlNWR0lEXzRfIgogICAgIGN4PSItMTguMzk2NSIKICAgICBjeT0iLTIyOS40ODI5IgogICAgIHI9IjEuNDkzMSIKICAgICBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDEwLjExMjUgMCAwIC0xMC4xMDQgMjA5LjY4OTEgLTIyOTkuMzUwMykiCiAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgogICAgPHN0b3AKICAgICAgIG9mZnNldD0iMCIKICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiM5QzlFOTkiCiAgICAgICBpZD0ic3RvcDMwIiAvPgogICAgPHN0b3AKICAgICAgIG9mZnNldD0iMSIKICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiM4Njg4ODMiCiAgICAgICBpZD0ic3RvcDMyIiAvPgogIDwvcmFkaWFsR3JhZGllbnQ+CiAgPHJhZGlhbEdyYWRpZW50CiAgICAgaWQ9IlNWR0lEXzVfIgogICAgIGN4PSI0Ni4zNjcyIgogICAgIGN5PSItNjY2IgogICAgIHI9IjEuODk1OCIKICAgICBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDcuNTk3MyAwIDAgLTMuODI0NSAtMzI5LjczOTMgLTI1MjQuODA3NikiCiAgICAgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgogICAgPHN0b3AKICAgICAgIG9mZnNldD0iMCIKICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiM1NTU3NTMiCiAgICAgICBpZD0ic3RvcDM5IiAvPgogICAgPHN0b3AKICAgICAgIG9mZnNldD0iMSIKICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiM1NTU3NTM7c3RvcC1vcGFjaXR5OjAiCiAgICAgICBpZD0ic3RvcDQxIiAvPgogIDwvcmFkaWFsR3JhZGllbnQ+Cjwvc3ZnPgo=">
    </icon>

    <icon
        id="blackcard.svg"
        data-url="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjI2MCI+Cgk8ZGVmcz4KCQk8bGluZWFyR3JhZGllbnQgaWQ9ImxnIiBncmFkaWVudFRyYW5zZm9ybT0icm90YXRlKDYwKSI+CgkJCTxzdG9wIHN0b3AtY29sb3I9IiNmZmYiIHN0b3Atb3BhY2l0eT0iLjYiIG9mZnNldD0iMCIgLz4KCQkJPHN0b3Agc3RvcC1jb2xvcj0iI2ZmZiIgc3RvcC1vcGFjaXR5PSIwIiBvZmZzZXQ9IjEiIC8+CgkJPC9saW5lYXJHcmFkaWVudD4KCTwvZGVmcz4KCTxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMjUyIiByeD0iMjUiIHg9IjYiIHk9IjYiIG9wYWNpdHk9IjAuNSIvPgoJPHJlY3Qgd2lkdGg9IjE5MCIgaGVpZ2h0PSIyNTAiIHJ4PSIyNSIgeD0iNSIgeT0iNSIgZmlsbD0iIzAwMDAwMCIvPgoJPHJlY3Qgd2lkdGg9IjE4MCIgaGVpZ2h0PSIyNDAiIHJ4PSIyMyIgeD0iMTAiIHk9IjEwIiBmaWxsPSJ1cmwoI2xnKSIgLz4KPC9zdmc+">
    </icon>

    <icon
        id="withdrawal.svg"
        data-url="PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHZlcnNpb249IjEuMCIKICAgd2lkdGg9IjE5MiIKICAgaGVpZ2h0PSIxOTIiCiAgIGlkPSJTdGFyIG9mIGxpZmUiPgogIDxkZWZzCiAgICAgaWQ9ImRlZnMyODg2IiAvPgogIDxnCiAgICAgaWQ9ImNyb3NzIj4KICAgIDxwYXRoCiAgICAgICBkPSJtIDc0LDEzMyAwLDUyIDQ0LDAgMCwtNTIgNDQsMjYgMjIsLTM4IEwgMTQwLDk2IDE4NCw3MCAxNjIsMzIgMTE3LDU4IDExNyw3IDc0LDcgNzQsNTggMzAsMzIgOCw3MCA1Miw5NiA4LDEyMSAzMCwxNTkgeiIKICAgICAgIGlkPSJvdXRsaW5lIgogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzMzMzNiYjtzdHJva2Utd2lkdGg6NiIgLz4KICAgIDxwYXRoCiAgICAgICBkPSJtIDc0LDEzMyAwLDUyIDQ0LDAgMCwtNTIgNDQsMjYgMjIsLTM4IEwgMTQwLDk2IDE4NCw3MCAxNjIsMzIgMTE3LDU4IDExNyw3IDc0LDcgNzQsNTggMzAsMzIgOCw3MCA1Miw5NiA4LDEyMSAzMCwxNTkgeiIKICAgICAgIGlkPSJpbm5lciIKICAgICAgIHN0eWxlPSJmaWxsOiMwMDAwYmI7ZmlsbC1ydWxlOmV2ZW5vZGQ7c3Ryb2tlOiNmZmZmZmY7c3Ryb2tlLXdpZHRoOjIiIC8+CiAgPC9nPgogIDxnCiAgICAgaWQ9InN5bWJvbHMiCiAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZjtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6IzMzMzNiYjtzdHJva2Utd2lkdGg6MiI+CiAgICA8cGF0aAogICAgICAgZD0ibSA5MywxNjYgYyAwLDcgNiw3IDYsMCBsIDMsLTEzOCBjIDAsLTggLTEyLC04IC0xMiwwIGwgMywxMzUgMCwzIHoiCiAgICAgICBpZD0icm9kIiAvPgogICAgPGcKICAgICAgIGlkPSJzbmFrZSI+CiAgICAgIDxwYXRoCiAgICAgICAgIGQ9Im0gMTAwLDE1MyBjIDcsNCAzLDE1IC0zLDE1IDIsLTUgMywtOSAzLC0xNSB6IG0gMSwtNDAgYyAxMCw5IDQsMjIgLTMsMjYgLTYsMyAtNiw3IC02LDE1IC05LC0xMCAtNCwtMTkgNCwtMjQgNSwtNCA1LC0xMCA1LC0xNyB6IG0gMSwtMzAgYyAwLDExIC0xNywxNCAtMTcsMjIgMCwzIDEsOSA2LDEyIDAsLTExIDksLTEyIDE1LC0xOCA3LC03IDcsLTE5IC00LC0yOCAwLDQgMCw4IDAsMTIgeiBNIDkwLDc3IEMgODAsNjkgNzYsNTUgODAsNDYgYyAzLC0xMCAyMCwtMTEgMjAsLTMgMCw4IC0yMCwzIC0xMywxNiBsIDMsNSAwLDEzIHoiCiAgICAgICAgIGlkPSJib2R5IiAvPgogICAgICA8cGF0aAogICAgICAgICBkPSJtIDk1LDQzIGMgNywtMyAtNywtMyAwLDAgeiIKICAgICAgICAgaWQ9ImV5ZSIKICAgICAgICAgc3R5bGU9ImZpbGw6IzMzMzNiYjtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2U6bm9uZSIgLz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=">
    </icon>

    <style>
      * {
        box-sizing: border-box;
      }

      .frame {
        width:      100vw;
        max-height: 100vh;
        margin:     auto;
        position:   absolute;
        top:0;  bottom:0;     /* vertical center */
        left:0; right:0;      /* horizontal center */
      }

      body {
        font-family: Arial, Helvetica, sans-serif;
        background-color: grey;
        -webkit-touch-callout: none; /* iOS Safari */
        -webkit-user-select: none;   /* Chrome 6.0+, Safari 3.1+, Edge & Opera 15+ */
        -moz-user-select: none;      /* Firefox */
        -ms-user-select: none;       /* IE 10+ and Edge */
        user-select: none;           /* Non-prefixed version,
                                        currently supported by Chrome and Opera */
      }

      #overlay {
        position: fixed;
        z-index: 1;
        top: 1vh;
        right: 2vw;
        width: 10vw;
      }

      /* Scorekeeper */
      .row {
        height:1vh;
      }

      .score {
        font-size: 10vh;
        text-align: center;
      }

      .spacer {
        font-size: 1vh;
        text-align: center;
      }

      .competition {
        font-size: 3vh;
        text-align: center;
      }

      .fencer-name, .fault, .point {
        font-size: 4vh;
        text-align: center;
      }

      .fencer-name {
        width: 50vw;
        overflow: hidden;
        text-overflow: ".";
      }

      .fencer-firstname {
        font-size: 2vh;
        text-align: center;
      }

      .fault {
        margin: 1vh 0vh 2vh 0vh;
      }

      td img {
        display: block;
        margin-left: auto;
        margin-right: auto;
      }

      /* Match list */
      td.td_matchlist {
        display: block;
        margin-left: auto;
        margin-right: auto;
      }

      table.table_matchlist, table_matchlist.table_scorekeeper {
        border-collapse: collapse;
        width: 100vw;
      }

      th.th_matchlist, td.td_matchlist {
        text-align: left;
      }

      td.td_match_id {
        text-align: left;
        font-size: 10vw;
      }

      td.td_piste {
        text-align: right;
      }

      tr.tr_matchlist {
        font-size: 5vw;
      }

      tr.tr_matchlist:nth-child(even) {
        background-color: Lightgreen;
      }
    </style>
  </head>

  <!--***********************************-->
  <script>
    var red_fencer;
    var green_fencer;
    var scorekeeper;
    var overlay;
    var matchlist;
    var socket      = new WebSocket ("ws://" + document.domain + ':' + location.port, "smartpoule");

    !function(e,t){"use strict";var n=null,a="ontouchstart"in e||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0,i=a?"touchstart":"mousedown",o=a?"touchend":"mouseup",m=a?"touchmove":"mousemove",u=0,r=0,s=10,c=10;function l(i){v(i);var m=i.target,u=parseInt(m.getAttribute("data-long-press-delay")||"1500",10);n=function(t,n){if(!(e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame&&e.mozCancelRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame))return e.setTimeout(t,n);var a=(new Date).getTime(),i={},o=function(){(new Date).getTime()-a>=n?t.call():i.value=requestAnimFrame(o)};return i.value=requestAnimFrame(o),i}(function(e){v();var n=a?e.touches[0].clientX:e.clientX,i=a?e.touches[0].clientY:e.clientY;this.dispatchEvent(new CustomEvent("long-press",{bubbles:!0,cancelable:!0,detail:{clientX:n,clientY:i}}))&&t.addEventListener(o,function e(n){t.removeEventListener(o,e,!0),function(e){e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation()}(n)},!0)}.bind(m,i),u)}function v(t){var a;(a=n)&&(e.cancelAnimationFrame?e.cancelAnimationFrame(a.value):e.webkitCancelAnimationFrame?e.webkitCancelAnimationFrame(a.value):e.webkitCancelRequestAnimationFrame?e.webkitCancelRequestAnimationFrame(a.value):e.mozCancelRequestAnimationFrame?e.mozCancelRequestAnimationFrame(a.value):e.oCancelRequestAnimationFrame?e.oCancelRequestAnimationFrame(a.value):e.msCancelRequestAnimationFrame?e.msCancelRequestAnimationFrame(a.value):clearTimeout(a)),n=null}"function"!=typeof e.CustomEvent&&(e.CustomEvent=function(e,n){n=n||{bubbles:!1,cancelable:!1,detail:void 0};var a=t.createEvent("CustomEvent");return a.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),a},e.CustomEvent.prototype=e.Event.prototype),e.requestAnimFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){e.setTimeout(t,1e3/60)},t.addEventListener(o,v,!0),t.addEventListener(m,function(e){var t=Math.abs(u-e.clientX),n=Math.abs(r-e.clientY);(t>=s||n>=c)&&v()},!0),t.addEventListener("wheel",v,!0),t.addEventListener("scroll",v,!0),t.addEventListener(i,function(e){u=e.clientX,r=e.clientY,l(e)},!0)}(window,document);

    function getMessageField (message,
                              field)
    {
      let pattern = new RegExp (field + '=.*\\n');

      if (pattern.test (message))
      {
        return message.match (pattern)[0];
      }
      return '';
    }

    // -- Score --------------------
    class Score {
      constructor (display)
      {
        this.status         = null;
        this.opponent_score = null;

        this.display = display;
        this.reset ();
      }

      setOpponentScore (opponent_score)
      {
        this.opponent_score = opponent_score;
      }

      setListener (listener)
      {
        this.listener = listener;
      }

      increment (delta)
      {
        if (this.status != null)
        {
          return false;
        }
        if (this.opponent_score != null)
        {
          if (this.opponent_score.status != null)
          {
            return false;
          }
        }

        this.points += delta;
        if (this.points >= 15)
        {
          this.status = 'V';
        }

        this.refresh ();

        return true;
      }

      setPoints (points)
      {
        if (points != null)
        {
          this.points = Number (points);
          this.refresh ();
        }
      }

      setStatus (status)
      {
        this.status = status;
        this.refresh ();
      }

      reset ()
      {
        this.points = 0
        this.refresh ();
      }

      refresh ()
      {
        let row_size = this.display.children[0].getBoundingClientRect().height;

        if (this.status == 'A')
        {
          let svg = document.getElementById ('withdrawal.svg');

          this.display.children[0].innerHTML = '<img src="data:image/svg+xml;base64,' + svg.dataset.url + '" width="' + row_size + '"/>';
        }
        else if (this.status == 'E')
        {
          let svg = document.getElementById ('blackcard.svg');

          this.display.children[0].innerHTML = '<img src="data:image/svg+xml;base64,' + svg.dataset.url + '" width="' + row_size*.7 + '"/>';
        }
        else if (this.status == 'V')
        {
          this.display.children[0].innerHTML = this.status + this.points
        }
        else
        {
          this.display.children[0].innerHTML = this.points
        }

        if (this.listener)
        {
          this.listener.onNewScore ();
        }
      }
    }


    // -- Sensor --------------------
    class Sensor {
      constructor ()
      {
        this.freezed = false;
      }

      setTrigger (trigger)
      {
        this.trigger = trigger;
        if (this.trigger != null)
        {
          let context = this;

          this.trigger.onclick = function () {Sensor.onClicked (context);};
          this.trigger.addEventListener ('long-press', function (e) {Sensor.onLongPress (context, e);});
        }
      }

      freeze ()
      {
        if (typeof window.orientation == 'undefined')
        {
          this.freezed = true;
        }
      }

      unFreeze ()
      {
        this.freezed = false;
      }

      static onClicked (what)
      {
        if (what.freezed == false)
        {
          what.onSensorClicked (what);
        }
        what.unFreeze ();
      }

      static onLongPress (what, e)
      {
        e.preventDefault ();
        what.freeze ();
        what.onSensorLongPress (what);
      }
    }


    // -- Counter --------------------
    class Counter extends Sensor {
      constructor (trigger,
                   countable,
                   step)
      {
        super ();

        this.countable = countable;
        this.step      = step;
        this.hits      = 0;

        this.setTrigger (trigger);
      }

      reset ()
      {
        this.hits = 0;
      }

      reStart ()
      {
        this.hits = 0;
        this.countable.reset ();
      }

      count ()
      {
        if (this.step >= 0)
        {
          this.hits++;
          return this.countable.increment (this.step);
        }
        return false;
      }

      onSensorClicked (sensor)
      {
        this.count ();
      }

      onSensorLongPress (sensor)
      {
        this.cancel ();
      }

      cancel ()
      {
        if (this.hits > 0)
        {
          this.hits--;
          return this.countable.increment (-this.step);
        }
        return false;
      }
    };


    // -- Light --------------------
    class Light extends Counter {
      constructor (trigger, countable, step)
      {
        super (trigger, countable, step);

        this.listeners = [];
      }

      onSensorClicked (sensor)
      {
      }

      cancel ()
      {
        this.countable.reset ();

        this.listeners.forEach (listener => listener.reset ());
      }

      addListener (counter)
      {
        this.listeners.push (counter);
      }
    };


    // -- Card --------------------
    class Card extends Sensor {
      constructor (listener,
                   cell,
                   html,
                   code)
      {
        super ();

        this.code     = code;
        this.listener = listener;

        cell.innerHTML = html
        cell.colSpan   = 2;
        this.setTrigger (cell);
      }

      reset ()
      {
        this.listener.onCardCancelled (this.code);
      }

      onSensorClicked (sensor)
      {
        this.listener.onCardClicked (this.code);
      }

      onSensorLongPress (sensor)
      {
        this.reset ();
      }
    };


    // -- FaultCounter --------------------
    class FaultCounter extends Counter {
      constructor (trigger,
                   penalties)
      {
        super (trigger, new Score (trigger), 1);

        this.penalties = penalties;
      }

      setCountable (countable)
      {
        this.counter1 = new Counter (null, countable, this.penalties[0]);
        this.counter2 = new Counter (null, countable, this.penalties[1]);
      }

      reset ()
      {
        this.counter2.reset ();
        this.counter1.reset ();

        this.reStart ();
      }

      count ()
      {
        let counter;

        if (this.counter1.hits > 0)
        {
          counter = this.counter2;
        }
        else
        {
          counter = this.counter1;
        }

        if (counter.count ())
        {
          super.count ();
        }
      }

      cancel ()
      {
        if (this.counter2.hits > 0)
        {
         this.counter2.cancel ();
        }
        else
        {
         this.counter1.cancel ();
        }

        if (counter.cancel ())
        {
          super.cancel ();
        }
      }
    };


    // -- Competition --------------------
    class Competition {
      constructor (xml)
      {
        this.xml     = xml;
        this.fencers = this.xml.getElementsByTagName ('Tireurs')[0];
      }

      get (attribute)
      {
        return this.xml.getAttribute (attribute);
      }

      getFencer (id)
      {
        for (let f = 0; f < this.fencers.childElementCount; f++)
        {
          let current = this.fencers.children[f];

          if (current.getAttribute ('ID') == id)
          {
            return current;
          }
        }
      }

      addPanel ()
      {
        let weapon  = {'S':'Sabre', 'E':'Epée', 'F':'Fleuret', 'X':'Educ', 'L':'Laser'};
        let gender  = {'M':'Homme', 'F':'Dame', 'X':'Mixte'};
        let lastRow = document.getElementById ('competition.panel');
        let cell    = lastRow.insertCell (-1);
        let html    = '';

        html += '</td>';
        html += '<td>';
        html += '  <div class="spacer">';
        html += '&nbsp';
        html += '  </div>';
        html += '  <div class="competition">';
        html +=     weapon[this.get ('Arme')] + ' '
        html +=     gender[this.get ('Sexe')] + ' ';
        html +=     this.get ('Categorie');
        html += '  </div>';
        html += '</td>';
        cell.innerHTML = html;

        cell.colSpan = 12;
        cell.style.background = this.get ('Couleur');
      }
    }


    // -- Batch --------------------
    class Batch {
      constructor (xml)
      {
        let context = this;
        let parser  = new DOMParser ();
        let xml_doc = parser.parseFromString (xml, 'text/xml');
        let root    = xml_doc.getElementsByTagName ('CompetitionIndividuelle')[0];
        let scheme  = '/CompetitionIndividuelle/RondeSuisse';

        this.competition = new Competition (root);

        {
          let nodes = xml_doc.evaluate (scheme, root, null, XPathResult.ANY_TYPE, null);
          let node  = nodes.iterateNext ();

          if (node)
          {
            this.stage = parseInt (node.getAttribute ('NetID'), 16);

            for (let i = 0; i < node.childElementCount; i++)
            {
              let match      = node.childNodes[i];
              let match_id   = match.getAttribute ('ID');
              let row        = matchlist.insertRow (-1);
              let match_over = false;

              row.setAttribute ('class', 'tr_matchlist');
              row.addEventListener ('click', function () {Batch.onClicked (context, match_id);});

              {
                let cell = row.insertCell (-1);
                let html = '<td><b>' + match.getAttribute ('ID') + '</b></td>';

                cell.setAttribute ('class', 'td_match_id');
                cell.innerHTML = html;
              }

              for (let f = 0; f < node.childNodes[i].childElementCount; f++)
              {
                let fencer_node = node.childNodes[i].childNodes[f];
                let fencer_id   = fencer_node.getAttribute ('REF');
                let fencer      = this.competition.getFencer (fencer_id);
                let cell        = row.insertCell (-1);
                let html        = '<td">' + fencer.getAttribute ('Nom') + '</td>';

                if (   (fencer_node.getAttribute ('Statut') == 'V')
                    || (fencer_node.getAttribute ('Statut') == 'A')
                    || (fencer_node.getAttribute ('Statut') == 'E'))
                {
                  match_over = true;
                }

                cell.setAttribute ('class', 'td_matchlist');
                cell.innerHTML = html;
              }

              {
                let cell = row.insertCell (-1);
                let html = '<td><b>Piste ' + match.getAttribute ('Piste') + '</b></td>';

                cell.setAttribute ('class', 'td_piste');
                cell.innerHTML = html;
              }

              {
                let cell     = row.insertCell (-1);
                let row_size = cell.getBoundingClientRect().height;
                let svg;
                let html;

              if (match_over)
              {
                  svg = document.getElementById ('ok.svg');
                  row.style.display = 'none';
                }
                else
                {
                  svg = document.getElementById ('ko.svg');
                }

                html = '<td><img src="data:image/svg+xml;base64,' + svg.dataset.url + '" width="' + row_size*.5 + '"/></td>';
                cell.innerHTML = html;
              }
            }
          }
        }
      }

      static onClicked (batch, match) {
        let msg = '';

        msg += '[Header]\n';
        msg += 'name=SmartPoule::ScoreSheetCall\n';
        msg += 'netid=0\n';
        msg += 'fitness=1\n';
        msg += '[Body]\n'
        msg += 'competition=' + batch.competition.get ('ID') + '\n';
        msg += 'stage=' + batch.stage + '\n';
        msg += 'bout=' + match + '\n';

        socket.send (msg);
      }
    }

    // -- ScoreSheet --------------------
    class ScoreSheet {
      constructor (msg,
                   red_fencer,
                   green_fencer)
      {
        let xml;

        {
          let tag    = 'xml=';
          let offset = msg.data.indexOf (tag);

          xml = msg.data.slice (offset + tag.length);
          xml = xml.split ('\n', 1)[0];
          xml = xml.replace (/\\n/g, '');
        }

        this.competition = getMessageField (msg.data, 'competition');
        this.stage       = getMessageField (msg.data, 'stage');

        {
          let parser      = new DOMParser ();
          let xml_doc     = parser.parseFromString (xml, 'text/xml');
          let root        = xml_doc.getElementsByTagName ('CompetitionIndividuelle')[0];
          let competition = new Competition (root);
          let schemes     = ['PhaseDeTableaux/SuiteDeTableaux/Tableau/Match', 'RondeSuisse/Match'];

          competition.addPanel ();

          for (let scheme of schemes)
          {
            let path  = '/CompetitionIndividuelle/' + scheme;
            let nodes = xml_doc.evaluate (path, root, null, XPathResult.ANY_TYPE, null);
            let node  = nodes.iterateNext ();

            if (node && node.childElementCount == 2)
            {
              this.bout    = 'bout=' + node.getAttribute ('ID') + '\n';
              this.fencers = [red_fencer, green_fencer];

              for (let f = 0; f < 2; f++)
              {
                this.fencers[f].display ();

                this.fencers[f].feed (competition, node.childNodes[f]);
                this.fencers[f].score.setListener (this);
              }
            }
          }
        }

        red_fencer.setOpponent   (green_fencer);
        green_fencer.setOpponent (red_fencer);
      }

      onNewScore ()
      {
        let dropped_match = false;
        let msg = '';

        msg += '[Header]\n';
        msg += 'name=SmartPoule::Score\n';
        msg += 'netid=0\n';
        msg += 'fitness=1\n';
        msg += '[Body]\n'
        msg += this.competition;
        msg += this.stage;
        msg += this.bout;
        msg += 'xml=<?xml version="1.0" encoding="UTF-8"?>'
        msg += '<Match>'

        for (let f = 0; f < 2; f++)
        {
          if (   (this.fencers[f].score.status == 'A')
              || (this.fencers[f].score.status == 'E'))
          {
            dropped_match = true;
            break;
          }
        }

        for (let f = 0; f < 2; f++)
        {
          msg += '<Tireur REF="' + this.fencers[f].ref + '"';
          if (dropped_match == false)
          {
            msg += ' Score="' + this.fencers[f].score.points + '"';
          }
          if (this.fencers[f].score.status != null)
          {
            msg += ' Statut="' + this.fencers[f].score.status + '"';
          }
          msg += '/>';
        }
        msg += '</Match>';

        socket.send (msg);
      }
    }


    // -- Fencer --------------------
    class Fencer {
      constructor (color)
      {
        this.rgb           = {'red':'#8F1818', 'green':'#098709'};
        this.color         = color;
        this.freezed       = false;
        this.taintedPanels = [];
        this.faults        = [{'color':'white',  'penalties':[0, 3]},
                              {'color':'orange', 'penalties':[3, 5]},
                              {'color':'red',    'penalties':[5, -1]}];
      }

      setOpponent (opponent)
      {
        this.opponent = opponent;

        for (let i = 0; i < this.faults.length; i++)
        {
          this.faults[i].counter.setCountable (opponent.score);
          this.light.addListener (opponent.faults[i].counter);
        }

        this.light.addListener (this.withdrawal_card);
        this.light.addListener (this.excluded_card);

        this.score.setOpponentScore (opponent.score);
      }

      onCardClicked (code)
      {
        if (this.score.status == code)
        {
          this.onCardCancelled ();
        }
        else if (code == 'V')
        {
          if (this.score.points >= this.opponent.score.points)
          {
            this.score.setStatus          ('V');
            this.opponent.score.setStatus ('D');
          }
        }
        else
        {
          this.score.setStatus (code);
        }
      }

      onCardCancelled (code)
      {
        this.score.setStatus          (null);
        this.opponent.score.setStatus (null);
      }

      display ()
      {
        this.addIdentityPanel ('name');
        this.addIdentityPanel ('firstname');
        this.addLightPanel    (this.color);
        this.addPointsPanel   ();
        this.addCardsPanel    ();
        this.addFaultsPanel   ();
      }

      feed (competition, node)
      {
        let name      = document.getElementById (this.color + '-fencer-name');
        let firstname = document.getElementById (this.color + '-fencer-firstname');

        this.taintedPanels.forEach (panel => panel.style.background = competition.get ('Couleur'));

        this.ref = node.getAttribute ('REF');
        name.innerHTML      = competition.getFencer (this.ref).getAttribute('Nom');
        firstname.innerHTML = competition.getFencer (this.ref).getAttribute('Prenom');

        this.score.setPoints (node.getAttribute ('Score'));
        this.score.setStatus (node.getAttribute ('Statut'));

        {
          let svg      = document.getElementById ('close.svg');
          let div      = document.getElementById ('overlay');
          let row_size = name.getBoundingClientRect().height;
          let html     = '';

          html += '<img onclick="CloseScorekeeper ();" src="data:image/svg+xml;base64,' + svg.dataset.url + '" width="' + row_size*1.0 + '"/>';
          div.innerHTML = html;
        }
      }

      addIdentityPanel (what)
      {
        let lastRow = document.getElementById (what + 's.panel');
        let cell    = lastRow.insertCell (-1);
        let html    = '';

        html += '<td>';
        html += '  <div id="' + this.color + '-fencer-' + what + '" class="fencer-' + what + '">';
        html +=     what;
        html += '  </div>';
        html += '</td>';
        cell.innerHTML = html;

        cell.colSpan = 6;

        this.taintedPanels.push (cell);
      }

      addLightPanel (color)
      {
        let lastRow = document.getElementById ('lights.panel');
        let cell    = lastRow.insertCell (-1);
        let html    = '';

        html += '<td>';
        html += '  <div class="score">0</div>';
        html += '</td>';
        cell.innerHTML = html;

        cell.colSpan = 6;
        cell.style.backgroundColor = this.rgb[color]

        this.score = new Score (cell);
        this.light = new Light (cell, this.score, 1);
      }

      addPointsPanel ()
      {
        let lastRow = document.getElementById ('points.panel');
        let points  = [1, 3, 5];

        for (let point of points)
        {
          let cell = lastRow.insertCell (-1);
          let html = '';

          html += '<td>';
          html += '  <div class="point">';
          html +=     point;
          html += '  </div>';
          html += '</td>';
          cell.innerHTML = html;

          cell.colSpan = 2;

          this.light.addListener (new Counter (cell,
                                               this.score,
                                               point));
        }
      }

      addCardsPanel ()
      {
        let svg             = document.getElementById ('withdrawal.svg');
        let lastRow         = document.getElementById ('cards.panel');
        let withdrawal_cell = lastRow.insertCell (-1);
        let victory_cell    = lastRow.insertCell (-1);
        let excluded_cell   = lastRow.insertCell (-1);
        let context         = this;
        let row_size;

        this.victory_card = new Card (this,
                                      victory_cell,
                                      '<td><div class="point">V</div></td>',
                                      'V');
        row_size = victory_cell.getBoundingClientRect().height;

        this.withdrawal_card = new Card (this,
                                         withdrawal_cell,
                                         '<td><img src="data:image/svg+xml;base64,' + svg.dataset.url + '" width="' + row_size*1.0 + '"/></td>',
                                         'A');

        svg = document.getElementById ('blackcard.svg');
        this.excluded_card = new Card (this,
                                       excluded_cell,
                                       '<td><img src="data:image/svg+xml;base64,' + svg.dataset.url + '" width="' + row_size*.7 + '"/></td>',
                                       'E');
      }

      addFaultsPanel ()
      {
        for (let fault of this.faults)
        {
          let lastRow = document.getElementById ('faults-' + fault.color + '.panel');
          let html    = '';
          let cell;

          lastRow.insertCell (-1);
          lastRow.insertCell (-1);
          cell = lastRow.insertCell (-1);

          html += '<td>';
          html += '  <div class="fault" style="background:' + fault.color + ';"></div>';
          html += '</td>';
          cell.innerHTML = html;

          cell.style.backgroundColor = 'grey';

          lastRow.insertCell (-1);
          lastRow.insertCell (-1);
          lastRow.insertCell (-1);

          fault.counter = new FaultCounter (cell,
                                            fault.penalties);
        }
      }
    }


    // -- Socket -------------------
    socket.onopen = function ()
    {
      red_fencer   = new Fencer ('red');
      green_fencer = new Fencer ('green');

      scorekeeper = document.getElementById ('scorekeeper');
      overlay     = document.getElementById ('overlay');
      matchlist   = document.getElementById ('matchlist');

      {
        let msg = '';

        msg += '[Header]\n';
        msg += 'name=SmartPoule::JobListCall\n';
        msg += 'netid=0\n';
        msg += 'fitness=1\n';

        socket.send (msg);
      }
    }

    socket.onclose = function ()
    {
    }

    socket.onmessage = function (msg)
    {
      if (msg.data.startsWith ('[Header]\nname=BellePoule::ScoreSheet'))
      {
        let table = scorekeeper.firstElementChild;
        for (let panel of table.rows)
        {
          while (panel.hasChildNodes ())
          {
            panel.removeChild (panel.firstChild);
          }
        }

        matchlist.style.display   = 'none';
        scorekeeper.style.display = 'block';
        overlay.style.display     = 'block';

        score_sheet = new ScoreSheet (msg,
                                      red_fencer,
                                      green_fencer);
      }
      else if (msg.data.startsWith ('[Header]\nname=BellePoule::Batch'))
      {
        while (matchlist.hasChildNodes ())
        {
          matchlist.removeChild (matchlist.firstChild);
        }

        tag     = 'fitness=';
        offset  = msg.data.indexOf (tag);
        fitness = msg.data.slice (offset + tag.length);
        fitness = fitness.split ('\n', 1)[0];
        fitness = fitness.replace (/\\n/g, '');

        if (fitness == '1')
        {
          tag    = 'xml=';
          offset = msg.data.indexOf (tag);
          xml    = msg.data.slice (offset + tag.length);
          xml    = xml.split ('\n', 1)[0];
          xml    = xml.replace (/\\n/g, '');
          batch  = new Batch (xml);
        }
      }
    }

    function CloseScorekeeper ()
    {
      matchlist.style.display   = 'table';
      scorekeeper.style.display = 'none';
      overlay.style.display     = 'none';
    }
  </script>

  <!--***********************************-->
  <body>
      <div class='frame'>
        <table id='matchlist' class='table_matchlist'></table>

        <div id='scorekeeper' class='table_scorekeeper' style='display:none'>
          <table Cellspacing='0'>
            <tr class='row' id='competition.panel'></tr>
            <tr class='row' id='names.panel'></tr>
            <tr class='row' id='firstnames.panel'></tr>
            <tr class='row' id='lights.panel'></tr>
            <tr class='row' id='points.panel'></tr>
            <tr class='row' id='cards.panel'></tr>
            <tr class='row' id='faults-white.panel'></tr>
            <tr class='row' id='faults-orange.panel'></tr>
            <tr class='row' id='faults-red.panel'></tr>
            <tr>
              <td Colspan='12'/>
            </tr>
          </table>

          <div id="overlay" style='display:none'></div>
        </div>
      </div>
  </body>
</html>
