<!DOCTYPE html>
<html>
  <title>SmartPoule</title>
  <meta charset="UTF-8">

  <!--***********************************-->
  <head>
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: Arial, Helvetica, sans-serif;
        width: 98%;
        height: 100%;
      }

      .box {
        float: left;
        width: 50%;
        padding: 30px;
      }

      .score {
        font-size: 15vh;
        text-align: center;
      }

    </style>
  </head>

  <!--***********************************-->
  <script>
    var path   = location.pathname;
    var socket = new WebSocket ("ws://" + document.domain + ':' + location.port, "smartpoule");
    var red_score
    var green_score


    // -- Score --------------------
    class Score {
      constructor (color) {
        this.color = color;

        this.light = document.getElementById (color + '_light');
        this.light.onclick = Score.onClicked;
        this.light.score   = this

        this.reset ()
      }

      dump () {
        console.log ("==>> " + this.color);
      }

      reset () {
        this.points = 0;
        this.refresh ();
      }

      increment () {
        this.points += 1;
        this.refresh ();
      }

      refresh () {
        this.light.children[0].innerHTML = this.points
      }

      static onClicked () {
        this.score.increment ();
      }
    };



    // -- Socket -------------------
    socket.onopen = function ()
    {
      console.log ("socket open " + "ws://" + document.domain + ':' + location.port, "smartpoule");
      document.getElementById ("path").innerHTML = path;

      red_score   = new Score ('red')
      green_score = new Score ('green')

      socket.send (path);
    }

    socket.onclose = function ()
    {
      console.log ("socket close");
    }

    socket.onmessage = function (msg)
    {
      document.getElementById ("num").innerHTML = msg.data;
    }
  </script>

  <!--***********************************-->
  <body>

    <p id="path"></p>
    <p id="num"></p>

    <div>
      <div class="box" id="red_light" style="background-color:#8F1818">
        <div class="score">5</div>
      </div>
    </div>
    <div>
      <div class="box" id="green_light" style="background-color:#098709">
        <div class="score">4</div>
      </div>
    </div>

  </body>
</html>
